%%{init: {
  "theme": "base",
  "themeVariables": {
    "primaryColor": "#4F46E5",
    "primaryTextColor": "#FFFFFF",
    "primaryBorderColor": "#3730A3",
    "secondaryColor": "#F0FDF4",
    "secondaryTextColor": "#166534",
    "secondaryBorderColor": "#86EFAC",
    "tertiaryColor": "#FFF7ED",
    "tertiaryTextColor": "#9A3412",
    "tertiaryBorderColor": "#FDBA74",
    "lineColor": "#6366F1",
    "textColor": "#1E293B",
    "fontSize": "15px",
    "fontFamily": "Inter, Segoe UI, Helvetica, Arial, sans-serif"
  },
  "flowchart": {
    "curve": "basis",
    "padding": 20,
    "nodeSpacing": 50,
    "rankSpacing": 60,
    "htmlLabels": true,
    "useMaxWidth": false
  }
}}%%

graph TB
    %% â”€â”€ Data Sources â”€â”€
    subgraph INGEST["ğŸ“¥  DATA INGESTION  â€”  30,000+ communications / month"]
        direction LR
        COMMS["ğŸ“§ Email, Phone,<br/>Chat, Letters"]
        SOCIAL["ğŸ“¡ Social Media<br/>X Â· Reddit Â· Trustpilot"]
        LETTERS["ğŸ“„ Scanned Letters<br/>OCR Digitised"]
    end

    %% â”€â”€ Auto-Classification â”€â”€
    CLASSIFY["âš¡ AI Auto-Classification<br/>Sentiment Â· Category Â· Product Â· Severity Â· Regulatory Tags"]

    %% â”€â”€ Four AI Engines â”€â”€
    subgraph ENGINES["ğŸ§   FOUR AI ENGINES"]
        direction LR

        subgraph RAG_BOX["  "]
            RAG_ICON["1ï¸âƒ£  RAG Engine"]
            RAG_DESC["Retrieval-Augmented Generation<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ¦ Hybrid search: dense + sparse vectors<br/>âœ¦ Contextual chunking with LLM prefixes<br/>âœ¦ Cross-encoder reranking for precision<br/>âœ¦ Finds the right evidence before answering"]
        end

        subgraph RRG_BOX["  "]
            RRG_ICON["2ï¸âƒ£  NL Query Engine"]
            RRG_DESC["Natural Language â†’ Database Query<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ¦ Plain English to Elasticsearch DSL<br/>âœ¦ Domain glossary with synonyms<br/>âœ¦ Aggregation & statistical intent<br/>âœ¦ Iterative query refinement"]
        end

        subgraph AGENT_BOX["  "]
            AGENT_ICON["3ï¸âƒ£  ReAct Agent"]
            AGENT_DESC["Autonomous Multi-Step Reasoning<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ¦ Think â†’ Act â†’ Observe â†’ Repeat<br/>âœ¦ 16 specialist analysis tools<br/>âœ¦ Confidence scoring per answer<br/>âœ¦ Full reasoning trace visible to user"]
        end

        subgraph STATS_BOX["  "]
            STATS_ICON["4ï¸âƒ£  Statistical Engine"]
            STATS_DESC["Python-Powered Numerical Analysis<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ¦ Outlier & anomaly detection<br/>âœ¦ Correlation analysis (Pearson)<br/>âœ¦ Trend & change-point detection<br/>âœ¦ Mathematical rigour for LLM context"]
        end
    end

    %% â”€â”€ LLM Layer â”€â”€
    subgraph LLM_LAYER["ğŸ”—  LLM PROVIDERS  â€”  Automatic Failover"]
        direction LR
        CLAUDE["ğŸŸ£ Anthropic Claude<br/>Primary"]
        GPT["ğŸŸ¢ OpenAI GPT-4o<br/>Fallback"]
    end

    %% â”€â”€ Analyst Experience â”€â”€
    subgraph ANALYST["ğŸ‘¤  ANALYST EXPERIENCE"]
        direction LR
        ASK["ğŸ’¬ Ask Any Question<br/>in Plain English"]
        EVIDENCE["ğŸ“ Evidence-Backed<br/>Answers with Citations"]
        REASONING["ğŸ” Visible Reasoning<br/>Steps & Tool Calls"]
        CONFIDENCE["ğŸ“Š Confidence Scores<br/>High Â· Medium Â· Low"]
    end

    %% â”€â”€ Connections â”€â”€
    COMMS --> CLASSIFY
    SOCIAL --> CLASSIFY
    LETTERS --> CLASSIFY

    CLASSIFY --> RAG_ICON
    CLASSIFY --> RRG_ICON

    RAG_ICON --> RAG_DESC
    RRG_ICON --> RRG_DESC
    AGENT_ICON --> AGENT_DESC
    STATS_ICON --> STATS_DESC

    RAG_ICON --> AGENT_ICON
    RRG_ICON --> AGENT_ICON
    STATS_ICON --> AGENT_ICON

    AGENT_ICON --> LLM_LAYER
    CLAUDE ~~~ GPT

    LLM_LAYER --> ASK
    ASK --> EVIDENCE
    EVIDENCE --> REASONING
    REASONING --> CONFIDENCE

    %% â”€â”€ Styles â”€â”€
    classDef ingestStyle fill:#EEF2FF,stroke:#6366F1,stroke-width:2px,color:#3730A3,font-weight:bold
    classDef classifyStyle fill:#4F46E5,stroke:#3730A3,stroke-width:2px,color:#FFFFFF,font-weight:bold
    classDef engineTitle fill:#7C3AED,stroke:#5B21B6,stroke-width:2px,color:#FFFFFF,font-weight:bold
    classDef engineDesc fill:#F5F3FF,stroke:#C4B5FD,stroke-width:1px,color:#4C1D95,text-align:left
    classDef llmStyle fill:#ECFDF5,stroke:#34D399,stroke-width:2px,color:#065F46,font-weight:bold
    classDef analystStyle fill:#FFF7ED,stroke:#FB923C,stroke-width:2px,color:#9A3412,font-weight:bold

    class COMMS,SOCIAL,LETTERS ingestStyle
    class CLASSIFY classifyStyle
    class RAG_ICON,RRG_ICON,AGENT_ICON,STATS_ICON engineTitle
    class RAG_DESC,RRG_DESC,AGENT_DESC,STATS_DESC engineDesc
    class CLAUDE,GPT llmStyle
    class ASK,EVIDENCE,REASONING,CONFIDENCE analystStyle

    style INGEST fill:#F8FAFC,stroke:#6366F1,stroke-width:2px,color:#4338CA,font-weight:bold
    style ENGINES fill:#FAF5FF,stroke:#7C3AED,stroke-width:3px,color:#5B21B6,font-weight:bold
    style LLM_LAYER fill:#F0FDF4,stroke:#34D399,stroke-width:2px,color:#065F46,font-weight:bold
    style ANALYST fill:#FFFBEB,stroke:#F59E0B,stroke-width:2px,color:#92400E,font-weight:bold
    style RAG_BOX fill:#F5F3FF,stroke:#C4B5FD,stroke-width:1px
    style RRG_BOX fill:#F5F3FF,stroke:#C4B5FD,stroke-width:1px
    style AGENT_BOX fill:#F5F3FF,stroke:#C4B5FD,stroke-width:1px
    style STATS_BOX fill:#F5F3FF,stroke:#C4B5FD,stroke-width:1px

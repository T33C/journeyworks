# Data Population Guide

This guide explains how to populate JourneyWorks with synthetic data for development, testing, and demonstrations.

## Overview

JourneyWorks uses synthetic data generators to create realistic customer journey data including:

- **Customers** - With tiers (platinum, gold, silver, bronze) and profile information
- **Communications** - Emails, phone calls, chats, and social interactions
- **Cases** - Support tickets linked to customers
- **Social Mentions** - Social media posts and brand mentions
- **Timeline Events** - System outages, product launches, policy changes
- **NPS Surveys** - Net Promoter Score data per journey stage

## Prerequisites

Before populating data, ensure these services are running:

| Service       | Port | Purpose                      |
| ------------- | ---- | ---------------------------- |
| API           | 3080 | REST API and data seeding    |
| Elasticsearch | 9280 | Data storage                 |
| Model Service | 8080 | Vector embeddings (optional) |

Start services with:

```bash
./scripts/start.sh --dev
```

## Quick Start

```bash
# Seed medium dataset (~500 communications)
./scripts/seed.sh

# Seed with vector embeddings for semantic search
./scripts/seed.sh --with-embeddings
```

---

## Seed Scripts

### Main Script: `seed.sh`

The primary seeding script with full control over dataset size and options.

**Location:** `scripts/seed.sh`

**Usage:**

```bash
./scripts/seed.sh [size] [options]
```

**Size Options:**

| Size     | Customers | Communications | Use Case                   |
| -------- | --------- | -------------- | -------------------------- |
| `small`  | 10        | ~50            | Quick testing, CI/CD       |
| `medium` | 50        | ~500           | Development (default)      |
| `large`  | 100       | ~2000          | Performance testing, demos |

**Flags:**

| Flag                   | Description                              |
| ---------------------- | ---------------------------------------- |
| `--keep-existing-data` | Don't clear existing data before seeding |
| `--with-embeddings`    | Generate vector embeddings after seeding |

**Examples:**

```bash
# Default medium dataset
./scripts/seed.sh

# Small dataset for quick tests
./scripts/seed.sh small

# Large dataset with embeddings
./scripts/seed.sh large --with-embeddings

# Add more data without clearing
./scripts/seed.sh small --keep-existing-data
```

### Shortcut Scripts

For convenience, there are shortcut scripts:

```bash
./scripts/seed-small.sh   # Equivalent to: ./scripts/seed.sh small
./scripts/seed-large.sh   # Equivalent to: ./scripts/seed.sh large
```

---

## Vector Embeddings

Vector embeddings enable semantic search capabilities. They are generated by the Model Service using the `all-MiniLM-L6-v2` model (384 dimensions, upgraded to 768 for production).

### Generating Embeddings

**Option 1: During seeding**

```bash
./scripts/seed.sh --with-embeddings
```

**Option 2: Standalone script**

```bash
./scripts/generate-embeddings.sh
```

### Embedding Generator Script

**Location:** `scripts/generate-embeddings.sh`

**Usage:**

```bash
./scripts/generate-embeddings.sh [options]
```

**Options:**

| Option      | Description              |
| ----------- | ------------------------ |
| `--limit N` | Process only N documents |
| `--help`    | Show usage information   |

**Examples:**

```bash
# Generate for all documents without embeddings
./scripts/generate-embeddings.sh

# Generate for first 100 documents only
./scripts/generate-embeddings.sh --limit 100
```

**Features:**

- Progress bar with percentage
- ETA calculation
- Processing rate (docs/sec)
- Stall detection to prevent infinite loops

**Sample Output:**

```
╔════════════════════════════════════════════════╗
║     JourneyWorks Embedding Generator           ║
╚════════════════════════════════════════════════╝

✓ API is running
✓ Model service is running (device: cpu)

Communications in index: 1322
Already have embeddings: 0
Need embeddings: 1322

Generating embeddings...

Progress: [████████████████████░░░░░░░░░░░░░░░░░░░░] 50% (661/1322) ETA: 0m 40s

╔════════════════════════════════════════════════╗
║        Embedding Generation Complete!          ║
╚════════════════════════════════════════════════╝

Summary:
  • Generated embeddings: 1322
  • Total with embeddings: 1322/1322
  • Time elapsed: 1m 20s
  • Rate: ~16.52 docs/sec
```

---

## API Endpoints

The seeding functionality is also available via REST API.

### Seed Data

```bash
# Medium dataset
POST http://localhost:3080/api/synthetic/seed

# Small dataset
POST http://localhost:3080/api/synthetic/seed/small

# Large dataset
POST http://localhost:3080/api/synthetic/seed/large
```

### Clear Data

```bash
DELETE http://localhost:3080/api/synthetic/clear
```

**Response:**

```json
{
  "customers": 50,
  "communications": 523,
  "cases": 45,
  "socialMentions": 120
}
```

### Generate Embeddings

```bash
# Generate for specific document IDs
POST http://localhost:3080/api/communications/embeddings/bulk
Content-Type: application/json

{
  "ids": ["doc-1", "doc-2", "doc-3"]
}

# Generate for N documents without embeddings
POST http://localhost:3080/api/communications/embeddings/bulk
Content-Type: application/json

{
  "limit": 100
}
```

### Check Embedding Status

```bash
# Count documents with embeddings
curl -s "http://localhost:9280/journeyworks_communications/_count" \
  -H "Content-Type: application/json" \
  -d '{"query":{"exists":{"field":"embedding"}}}'

# Count total documents
curl -s "http://localhost:9280/journeyworks_communications/_count"
```

---

## Generated Data Structure

### Customers

| Field           | Description                    |
| --------------- | ------------------------------ |
| `id`            | Unique identifier              |
| `name`          | Customer name                  |
| `email`         | Email address                  |
| `tier`          | platinum, gold, silver, bronze |
| `createdAt`     | Account creation date          |
| `lifetimeValue` | Estimated customer value       |

### Communications

| Field            | Description                   |
| ---------------- | ----------------------------- |
| `id`             | Unique identifier             |
| `customerId`     | Link to customer              |
| `channel`        | email, phone, chat, social    |
| `direction`      | inbound, outbound             |
| `subject`        | Communication subject         |
| `content`        | Full message content          |
| `sentiment`      | Sentiment score (-1 to 1)     |
| `classification` | AI-generated category         |
| `embedding`      | 768-dim vector (if generated) |
| `createdAt`      | Timestamp                     |

### Cases

| Field         | Description                         |
| ------------- | ----------------------------------- |
| `id`          | Unique identifier                   |
| `customerId`  | Link to customer                    |
| `status`      | open, in-progress, resolved, closed |
| `priority`    | low, medium, high, critical         |
| `category`    | Case category                       |
| `description` | Case details                        |

### Timeline Events

| Field         | Description                      |
| ------------- | -------------------------------- |
| `id`          | Unique identifier                |
| `type`        | outage, launch, policy_change    |
| `title`       | Event title                      |
| `description` | Event details                    |
| `startDate`   | When event began                 |
| `endDate`     | When event ended (if applicable) |
| `impact`      | Impact level                     |

---

## Troubleshooting

### "API is not running on port 3080"

Start the API server:

```bash
./scripts/start.sh --dev
# or
cd journeyworks-api && npm run start:dev
```

### "Model service is not running on port 8080"

Start the model service:

```bash
cd python/model-service && ./run.sh
```

### Embeddings not generating

1. Check model service health:

   ```bash
   curl http://localhost:8080/health
   ```

2. Verify Elasticsearch is accessible:

   ```bash
   curl http://localhost:9280/_cluster/health
   ```

3. Check API logs for errors:
   ```bash
   # In the API terminal, look for error messages
   ```

### Slow embedding generation

- **CPU mode**: ~15-20 docs/sec (expected on Mac without GPU)
- **GPU mode**: ~100+ docs/sec

Check compute device:

```bash
curl http://localhost:8080/health | jq '.compute_device'
```

---

## Best Practices

1. **Development**: Use `small` dataset for fast iteration
2. **Testing**: Use `medium` dataset for realistic scenarios
3. **Demos**: Use `large` with embeddings for full feature showcase
4. **CI/CD**: Use `small` without embeddings for speed

---

## Related Documentation

- [Model Service README](../python/model-service/README.md) - Embedding model details
- [API README](../journeyworks-api/README.md) - Full API documentation
- [Architecture](./proposal/architecture-diagram.md) - System architecture
